# FERP XMP Metadata Contract v1.0

## Document Control

* **Title:** FERP XMP Metadata Contract
* **Version:** 1.0
* **Status:** Approved – implementation-ready
* **Scope:** Defines how FERP embeds and how consumers read publisher-list metadata in PDF files.

---

## 1) Purpose

This contract defines a standards-aligned mechanism for embedding a **list of music publishing companies referenced by a document** into PDF files.

The metadata is intended to be:

* durable across third-party PDF processing tools,
* authoritative for automated systems,
* optionally visible in standard PDF UI applications without relying on their preservation guarantees.

---

## 2) Design Principles

1. **XMP is authoritative**
   All automated systems MUST rely on XMP metadata for correctness.

2. **PDF Info metadata is volatile**
   Standard PDF metadata fields (e.g., `/Keywords`) are treated as presentation-only and may be dropped or rewritten by downstream tools.

3. **No semantic overloading**
   Document-level metadata standards (e.g., Dublin Core) are not repurposed to represent domain-specific music publishing data.

4. **Loss resistance over convenience**
   Metadata durability takes precedence over UI discoverability.

---

## 3) Standards and Conventions

* **XMP packet** embedded in the PDF catalog `/Metadata` stream

  * `/Type /Metadata`
  * `/Subtype /XML`
* **RDF container types** per XMP specification
* **UTF-8 text encoding**
* Namespace URIs are identifiers and are not required to resolve.

---

## 4) Namespace

### 4.1 Custom Namespace

* **Preferred XML prefix:** `ferp`
* **Namespace URI:**

  ```
  https://tulbox.app/ferp/xmp/1.0
  ```

### 4.2 Standard Namespaces Used

* RDF: `http://www.w3.org/1999/02/22-rdf-syntax-ns#`
* XMP container: `adobe:ns:meta/`

---

## 5) Property Definitions

### 5.1 Authoritative Property

**Property:** `ferp:publishers`

* **Type:** `rdf:Bag` of `rdf:li` (`xsd:string`)
* **Cardinality:** 0..n
* **Order:** Unordered
* **Semantics:**
  List of **music publishing companies referenced by the document content**.
* **Authority:** **Authoritative** source for all automated processing.

#### Example

```xml
<ferp:publishers>
  <rdf:Bag>
    <rdf:li>Universal Music Publishing Group</rdf:li>
    <rdf:li>Sony Music Publishing</rdf:li>
    <rdf:li>Warner Chappell Music</rdf:li>
  </rdf:Bag>
</ferp:publishers>
```

---

## 6) Normalization Rules

Normalization MUST be applied before writing `ferp:publishers`.

For each publisher value:

1. Trim leading and trailing whitespace.
2. Collapse internal whitespace to a single ASCII space (`U+0020`).
3. Remove empty values.
4. De-duplicate by exact match after normalization.
5. Preserve original casing.
6. Preserve punctuation.

Recommended behavior: preserve first occurrence when de-duplicating.

---

## 7) UI Surfacing via PDF Info Metadata (Non-Authoritative)

### 7.1 `/Keywords` Usage

FERP MAY surface publisher information into the PDF Info `/Keywords` field **for human visibility only**.

* `/Keywords` is **not authoritative**
* `/Keywords` is **not guaranteed to persist**
* `/Keywords` MUST NOT be relied upon by automated systems

### 7.2 Required Marking

If used, the value MUST be clearly marked to avoid ambiguity:

```
FERP_PUBLISHERS=Universal Music Publishing Group | Sony Music Publishing | Warner Chappell Music
```

* Prefix: `FERP_PUBLISHERS=`
* Separator: `|` (space-pipe-space)
* Derived directly from normalized `ferp:publishers`

### 7.3 Stability Warning (Normative)

> Automated systems MUST assume `/Keywords` may be absent, truncated, rewritten, or removed by downstream tools and MUST NOT treat its presence or absence as meaningful.

---

## 8) Write Requirements

A compliant writer MUST:

1. Embed an XMP packet in the PDF catalog metadata stream.
2. Write `ferp:publishers` exactly as defined in Section 5.
3. Ensure XML is valid UTF-8 and properly escaped.

A compliant writer MAY:

* Write `/Keywords` as described in Section 7 for UI visibility.

A compliant writer SHOULD:

* Preserve unrelated existing XMP content when updating metadata.

---

## 9) Read Requirements

A compliant reader MUST:

1. Read `ferp:publishers` from XMP if present.
2. Apply normalization rules after reading.

A compliant reader MAY:

* Fall back to parsing `/Keywords` **only** if XMP is absent and only for best-effort, non-authoritative behavior.

### Authority Rule

If both XMP and `/Keywords` are present and differ:

* **XMP always wins**
* `/Keywords` MUST be ignored for correctness

---

## 10) Canonical Minimal XMP Example

```xml
<?xpacket begin='﻿' id='W5M0MpCehiHzreSzNTczkc9d'?>
<x:xmpmeta xmlns:x="adobe:ns:meta/">
  <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
    <rdf:Description xmlns:ferp="https://tulbox.app/ferp/xmp/1.0">
      <ferp:publishers>
        <rdf:Bag>
          <rdf:li>Universal Music Publishing Group</rdf:li>
          <rdf:li>Sony Music Publishing</rdf:li>
        </rdf:Bag>
      </ferp:publishers>
    </rdf:Description>
  </rdf:RDF>
</x:xmpmeta>
<?xpacket end='w'?>
```

---

## 11) Versioning Policy

* Namespace `https://tulbox.app/ferp/xmp/1.0` is immutable.
* Any breaking change requires a new namespace version (e.g., `/2.0`).
* Older namespaces MUST continue to be supported for reading.

---

## 12) Compliance Summary

### Writers

* MUST write XMP `ferp:publishers`
* MAY write `/Keywords` as sugar
* MUST NOT rely on `/Keywords` for correctness

### Readers

* MUST rely on XMP
* MAY fall back to `/Keywords`
* MUST NOT treat `/Keywords` as stable or authoritative

